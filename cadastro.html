<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Cadastro - Batalha Naval</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
</head>
<body>

<div class="box">
  <h2>Cadastro</h2>
  <input type="text" id="nome" placeholder="Nome de usuário">
  <input type="email" id="email" placeholder="E-mail">
  <input type="password" id="senha" placeholder="Senha (mín. 6)">
  <button onclick="cadastrar()">Criar Conta</button>
  <p>Já tem conta?<br><a href="index.html">Entrar</a></p>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBxq1jjSig-yW0kmtR1d_WBYCcc7Ysjz00",
  authDomain: "batalha-naval-web-5c204.firebaseapp.com",
  databaseURL: "https://batalha-naval-web-5c204-default-rtdb.firebaseio.com",
  projectId: "batalha-naval-web-5c204"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getDatabase(app);

window.cadastrar = async () => {
  const nomeUsuario = nome.value.trim();
  const emailUsuario = email.value.trim();
  const senhaUsuario = senha.value;

  if(!nomeUsuario || !emailUsuario || !senhaUsuario){
    return alert("Preencha todos os campos!");
  }

  if(senhaUsuario.length < 6){
    return alert("Senha mínima de 6 caracteres");
  }

  try {
    const cred = await createUserWithEmailAndPassword(auth, emailUsuario, senhaUsuario);
    const uid = cred.user.uid;

    // Salva nome, pontos e vitórias
    await set(ref(db, `usuarios/${uid}`), {
      nome: nomeUsuario,
      pontos: 0,
      vitorias: 0
    });

    // Salva localmente para usar na sala
    localStorage.setItem("nomeUsuario", nomeUsuario);
    localStorage.setItem("uidUsuario", uid);

    alert("Cadastro realizado com sucesso!");
    window.location.href = "rank.html";
  } catch(err){
    alert(err.message);
  }
};
</script>

</body>
</html>
